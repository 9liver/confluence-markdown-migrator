<p>Trainer: Osman Omer</p><p>Attendees: Björn Gräbe, Erwin Schmidt (more attendess possible)</p><h1 id="AnsibleWorkshop-Goals">Goals</h1><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 97.25%;"><colgroup><col style="width: 29.56%;"/><col style="width: 64.87%;"/><col style="width: 5.56%;"/></colgroup><tbody><tr><th class="confluenceTh">Goal</th><th class="confluenceTh">Notes</th><th class="confluenceTh">Status</th></tr><tr><td class="confluenceTd">Build a fast solution for information gathering and analysis of the whole AIX landscape of Oediv.</td><td class="confluenceTd"><br/></td><td class="highlight-green confluenceTd" style="text-align: center;" title="Hintergrundfarbe : Grün" data-highlight-colour="green">DONE</td></tr><tr><td colspan="1" class="confluenceTd">Local yum repositorie</td><td colspan="1" class="confluenceTd"><pre>yum install createrepo<br/>cd to folder<br/>createrepo noarch (creates Folder repodata)<br/>/opt/freeware/etc/yum/yum.conf<br/><br/>[AIX_Toolbox_noarch_local]<br/>name=AIX noarch local repository<br/>baseurl=<a href="file:///tmp/repotest/noarch" class="external-link" rel="nofollow">file:///tmp/repotest/noarch</a><br/>enabled=1 #0 to disable it<br/>gpgcheck=0</pre></td><td class="highlight-green confluenceTd" style="text-align: center;" title="Background colour : Green" colspan="1" data-highlight-colour="green"> DONE</td></tr><tr><td colspan="1" class="confluenceTd">Execute commands on all AIX-Machine</td><td colspan="1" class="confluenceTd"><pre>ansible all -m shell -a 'ifconfig -a'<br/><br/>ansible all -m shell -a 'hostname' -o</pre></td><td class="highlight-green confluenceTd" style="text-align: center;" title="Background colour : Green" colspan="1" data-highlight-colour="green">DONE</td></tr><tr><td colspan="1" class="confluenceTd"><p>Build Groups for executing and changing things on different categories: WPARs/LPARs, test system/production systems, VIOS/none VIOS </p></td><td colspan="1" class="confluenceTd"><pre>/etc/ansible/hosts<br/><br/>[testclients]<br/>10.234.100.10<br/>10.234.100.11</pre></td><td class="highlight-green confluenceTd" style="text-align: center;" title="Hintergrundfarbe : Grün" colspan="1" data-highlight-colour="green">DONE</td></tr><tr><td colspan="1" class="confluenceTd">Install iFixes on AIX Systems &quot;in Waves&quot;</td><td colspan="1" class="confluenceTd"><br/></td><td class="highlight-green confluenceTd" style="text-align: center;" title="Hintergrundfarbe : Grün" colspan="1" data-highlight-colour="green">DONE</td></tr><tr><td colspan="1" class="confluenceTd">Install Software and update on AIX Systems &quot;in Waves&quot;</td><td colspan="1" class="confluenceTd"><p>Ansible Module: installp</p><pre>- name: Install Java<br/>  installp:<br/>  accept_license: yes<br/>  repository_path: /ansible-mnt/aix/Java8<br/>  name: Java8_64.jre<br/>  state: present<br/><br/></pre></td><td class="highlight-green confluenceTd" style="text-align: center;" title="Background colour : Green" colspan="1" data-highlight-colour="green">DONE</td></tr><tr><td colspan="1" class="confluenceTd">Maintain a system list consistent with reality</td><td colspan="1" class="confluenceTd">Has to be integratet in the install process AIX</td><td class="highlight-green confluenceTd" style="text-align: center;" title="Background colour : Green" colspan="1" data-highlight-colour="green">DONE</td></tr><tr><td colspan="1" class="confluenceTd">Change files on multipe AIX-Systems or on the whole AIx enviroment</td><td colspan="1" class="confluenceTd"><pre>---<br/>- name: Change 02sapbasis to new blabla<br/>  hosts: all<br/>  tasks:<br/>  - name: Changing file<br/>    replace:<br/>      path: /etc/sudo.d/02sapbasis<br/>      regexp: '/int/sappatch/'<br/>      replace: '/int/software/sappatch/'<br/>      backup: yes<br/><br/></pre></td><td class="highlight-green confluenceTd" style="text-align: center;" title="Hintergrundfarbe : Grün" colspan="1" data-highlight-colour="green">DONE</td></tr><tr><td colspan="1" class="confluenceTd"> Create Users</td><td colspan="1" class="confluenceTd"><pre>module user or just use shell </pre><p><br/></p></td><td class="highlight-green confluenceTd" style="text-align: center;" title="Hintergrundfarbe : Grün" colspan="1" data-highlight-colour="green">DONE</td></tr><tr><td colspan="1" class="confluenceTd"> List Users</td><td colspan="1" class="confluenceTd"><pre>module Shell<br/><br/>shell: lsuser &lt;username&gt;</pre></td><td class="highlight-green confluenceTd" style="text-align: center;" title="Hintergrundfarbe : Grün" colspan="1" data-highlight-colour="green">DONE</td></tr><tr><td colspan="1" class="confluenceTd"> Verbose success list</td><td colspan="1" class="confluenceTd"><pre>ansible-playbook -v(vv) playbook</pre></td><td class="highlight-green confluenceTd" style="text-align: center;" title="Background colour : Green" colspan="1" data-highlight-colour="green">DONE</td></tr><tr><td colspan="1" class="confluenceTd"> Set file permission and owners</td><td colspan="1" class="confluenceTd"><pre>---<br/>- name: Change file attributes<br/>  hosts: all<br/>  tasks:<br/>  - name: Change file attributes<br/>    file:<br/>      path: /tmp/filetest.txt<br/>      owner: graebebsa<br/>      group: staff<br/>      mode: 0777</pre></td><td class="highlight-green confluenceTd" style="text-align: center;" title="Hintergrundfarbe : Grün" colspan="1" data-highlight-colour="green">DONE</td></tr><tr><td colspan="1" class="confluenceTd"> Retrieve file permissions</td><td colspan="1" class="confluenceTd"><pre>Script</pre></td><td class="highlight-green confluenceTd" style="text-align: center;" title="Hintergrundfarbe : Grün" colspan="1" data-highlight-colour="green"> DONE</td></tr><tr><td colspan="1" class="confluenceTd"> Execute Scripts</td><td colspan="1" class="confluenceTd"><pre>---<br/>- name: Test Script Module<br/>  hosts: all<br/>  tasks:<br/>  - name: Execue Script<br/>    script: /tmp/ansible_workshop/playbooks/testscript.sh<br/><br/>Ansible with pipe the output the stdout on the master in oposite to ansible-playbook </pre></td><td class="highlight-green confluenceTd" style="text-align: center;" title="Background colour : Green" colspan="1" data-highlight-colour="green"> DONE</td></tr><tr><td colspan="1" class="confluenceTd"> Test Cconnections Localy (is Port open)</td><td colspan="1" class="confluenceTd"><pre>Script, with ansible (not ansible-playbook)</pre></td><td class="highlight-green confluenceTd" style="text-align: center;" title="Hintergrundfarbe : Grün" colspan="1" data-highlight-colour="green">DONE</td></tr><tr><td colspan="1" class="confluenceTd"> Patterns for Playbooks?</td><td colspan="1" class="confluenceTd"><pre>---<br/>- name:  Install JAVA from NIM<br/>  hosts: 10.234.100.11<br/>  tasks:<br/>  - name: Include Mount<br/>    include: ansible_mounts.yml<br/><br/>   do something<br/><br/>  - name: Include umount<br/>    include: ansible_umounts.yml</pre></td><td class="highlight-green confluenceTd" style="text-align: center;" title="Hintergrundfarbe : Grün" colspan="1" data-highlight-colour="green">DONE</td></tr><tr><td colspan="1" class="confluenceTd">Become Statement</td><td colspan="1" class="confluenceTd"><br/></td><td class="highlight-green confluenceTd" style="text-align: center;" title="Hintergrundfarbe : Grün" colspan="1" data-highlight-colour="green">DONE</td></tr><tr><td colspan="1" class="confluenceTd">Check for Operating Systems</td><td colspan="1" class="confluenceTd"><pre> Scripts: ansible all -m shell -a &quot;oslevel -s&quot; -o</pre></td><td class="highlight-green confluenceTd" style="text-align: center;" title="Hintergrundfarbe : Grün" colspan="1" data-highlight-colour="green">DONE</td></tr><tr><td colspan="1" class="confluenceTd">Basic understating of roles</td><td colspan="1" class="confluenceTd"><a href="https://docs.ansible.com/ansible/2.7/user_guide/playbooks_reuse_roles.html?highlight=roles&amp;extIdCarryOver=true&amp;sc_cid=701f2000001OH6uAAG" class="external-link" rel="nofollow"><span>https://docs.ansible.com/ansible/2.7/user_guide/playbooks_reuse_roles.html?highlight=roles&amp;extIdCarryOver=true&amp;sc_cid=701f2000001OH6uAAG</span></a> </td><td class="highlight-green confluenceTd" style="text-align: center;" title="Hintergrundfarbe : Grün" colspan="1" data-highlight-colour="green">DONE</td></tr><tr><td colspan="1" class="confluenceTd"> with_items</td><td colspan="1" class="confluenceTd"><pre>  - name: Create some files<br/>    file:<br/>      path: &quot;{{ item }}&quot;<br/>      state: touch<br/>    with_items:<br/>      - /ansible/file1.txt<br/>      - /ansible/file2.txt</pre></td><td class="highlight-green confluenceTd" style="text-align: center;" title="Hintergrundfarbe : Grün" colspan="1" data-highlight-colour="green">DONE</td></tr><tr><td colspan="1" class="confluenceTd"> with_file</td><td colspan="1" class="confluenceTd"><p>---<br/>- name: Output files<br/>  hosts: all<br/>  tasks:<br/>  - name: Output files<br/>    # emit a debug message containing the content of each file.<br/>    debug:<br/>        msg: &quot;{{ item }}&quot;<br/>    with_file:<br/>        - /etc/hosts<br/>#        - /ansible/file1.txt<br/>#        - /ansible/file2.txt<br/><br/>Files are search on the ansible controller.</p></td><td class="highlight-green confluenceTd" style="text-align: center;" title="Hintergrundfarbe : Grün" colspan="1" data-highlight-colour="green"> DONE</td></tr></tbody></table></div><h1 id="AnsibleWorkshop-Rooms">Rooms</h1><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/><col/><col/><col/></colgroup><tbody><tr><th class="confluenceTh">Mon</th><th class="confluenceTh">Tue</th><th class="confluenceTh">Wed</th><th class="confluenceTh">Thu</th><th class="confluenceTh">Fri</th></tr><tr><td class="confluenceTd">Merkur</td><td class="confluenceTd">Merkur</td><td class="confluenceTd">Jupiter</td><td class="confluenceTd">Merkur</td><td class="confluenceTd">Merkur</td></tr><tr><td colspan="1" class="confluenceTd"> 09:00 - ?</td><td colspan="1" class="confluenceTd"> 09:00 - ?</td><td colspan="1" class="confluenceTd">  09:00 - ?</td><td colspan="1" class="confluenceTd">   09:00 - ?</td><td colspan="1" class="confluenceTd">   (09:00 - ?)</td></tr></tbody></table></div><h1 id="AnsibleWorkshop-Environment">Environment</h1><p>The environment for the Ansible workshop consists of three LPARs on :</p><ul><li>sys-oed-125-a: 10.234.100.9 (Ansible server)</li><li>sys-oed-126-a: 10.234.100.10 (Ansible client)</li><li>sys-oed-127-a: 10.234.100.11(Ansible Client)</li></ul><h1 id="AnsibleWorkshop-Resultsbyday">Results by day</h1><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 70.54%;"><colgroup><col style="width: 8.07%;"/><col style="width: 91.91%;"/></colgroup><tbody><tr><th class="confluenceTh">Day</th><th class="confluenceTh">Results</th></tr><tr><td class="confluenceTd">Monday</td><td class="confluenceTd"><div class="content-wrapper"><p><a href="/display/ICS/Ansible+Workshop?preview=%2F42974566%2F42975276%2Fansible-tag1.txt"><span style="background: url('/s/t1v677/8703/51k4y0/5.1.2/_/download/resources/com.atlassian.confluence.plugins.confluence-view-file-macro:view-file-macro-resources/images/placeholder-medium-text.png'); width: 177px; height: 95px; display: inline-block; padding-top: 155px; margin: 2px; border: 1px solid #ddd; text-align: center; vertical-align: text-bottom; text-decoration: none; font-size: 12px; color: #000;">ansible-tag1.txt</span></a></p><p>Ansible is succesfully installed on sys-oed-125-a</p><p>installed ansible packages: </p><p><a href="https://github.com/kairoaraujo/ansible-aix-support/releases/download/0.3.1/ansible-aix-support-0.3.1.tar.gz" class="external-link" rel="nofollow"><span>https://github.com/kairoaraujo/ansible-aix-support/releases/download/0.3.1/ansible-aix-support-0.3.1.tar.gz</span></a><span> </span></p></div></td></tr><tr><td class="confluenceTd">Tuesday</td><td class="confluenceTd"><p>ansible-aix-support package: install-ansible-aix-suppoert.sh</p><p>Folder to find modules: /opt/free/lib/python2.7/site-packages/ansible</p><p>ansible-doc user (example) (Refer to this, because the online documentation is current and does not necessarly mean it is right forthe current installation</p><p>jumphost ist possible:</p><p><a href="https://docs.ansible.com/ansible/2.7/reference_appendices/faq.html#how-do-i-generate-crypted-passwords-for-the-user-module" class="external-link" rel="nofollow">https://docs.ansible.com/ansible/2.7/reference_appendices/faq.html#how-do-i-generate-crypted-passwords-for-the-user-module</a><span lang="EN"> </span></p><p><br/></p><p><span lang="EN">DON'T use the mount module, it is only suitable for Linux</span></p><p><span lang="EN">Be carefull with the aix_filesystems module. The option to remove the mount point does not work, IT ALWAYS REMOVES THE MOUNT POINT!</span></p><p><span lang="EN">Use a seperate mount-points to for all ansible related tasks.</span></p></td></tr><tr><td class="confluenceTd">Wednesday</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd">Thursday</td><td class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd"> Friday</td><td colspan="1" class="confluenceTd"><br/></td></tr></tbody></table></div>